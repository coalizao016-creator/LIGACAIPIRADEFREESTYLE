<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Ranking - Coaliz√£o 016</title>
    
    <link rel="stylesheet" href="styles.css" />

    <style>
        /* Estilos para a p√°gina de Ranking */
        .ranking-container { max-width: 900px; margin: 0 auto; padding: 20px; text-align: center; }
        .explicacao { background-color: #222; border-radius: 10px; padding: 30px; margin-bottom: 40px; }
        .explicacao h2 { margin-top: 0; color: #ff8c00; }
        .explicacao p { color: #ccc; line-height: 1.6; font-size: 1.1em; }
        
        /* Estilos do Regulamento Expans√≠vel */
        .regulamento-container {
            background-color: #282828;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 40px;
            text-align: left;
        }
        .regulamento-container details { border: 1px solid #444; border-radius: 5px; padding: 15px; }
        .regulamento-container summary {
            font-weight: bold;
            color: #ff8c00;
            font-size: 1.2em;
            cursor: pointer;
            outline: none;
        }
        .regulamento-container .regulamento-content { margin-top: 20px; line-height: 1.7; color: #e0e0e0; }
        .regulamento-container .regulamento-content h3 { color: #fff; border-bottom: 1px solid #444; padding-bottom: 5px; margin-top: 30px; }
        .regulamento-container .regulamento-content ul, .regulamento-container .regulamento-content ol { padding-left: 20px; }
        .regulamento-container .regulamento-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .regulamento-container .regulamento-content th, .regulamento-container .regulamento-content td {
            border: 1px solid #444;
            padding: 8px;
            text-align: left;
        }
        .regulamento-container .regulamento-content th {
            background-color: #1a1a1a;
            color: #ff8c00;
        }

        /* Estilos da Tabela de Ranking */
        .ranking-table-container { background-color: #282828; padding: 20px; border-radius: 10px; }
        .ranking-table-container h2 { color: #fff; }
        #ranking-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        #ranking-table thead { background-color: #1a1a1a; }
        #ranking-table th { padding: 15px; color: #ff8c00; text-align: left; }
        #ranking-table td { padding: 15px; color: #e0e0e0; text-align: left; border-top: 1px solid #333; }
        #ranking-table tbody tr:nth-child(even) { background-color: #222; }
        #ranking-table tbody tr:hover { background-color: #383838; }
        #ranking-table .posicao { font-weight: bold; font-size: 1.2em; text-align: center; width: 60px; }
        #ranking-table .mc-nome { font-weight: bold; color: #fff; }
        #ranking-table .mc-pontos { font-weight: bold; color: #ff8c00; text-align: right; }
    </style>
</head>
<body>
    <header>
    </header>

    <nav>
        <div class="hamburger">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
        </div>
        <div class="nav-links">
            <a href="index.html">In√≠cio</a>
            <a href="batalhas.html">Batalhas</a>
            <a href="mcs.html">MC's</a>
            <a href="mapaindex.html">Mapa</a>
            <a href="ranking.html"><strong>Ranking</strong></a>
            <div class="dropdown">
                <a href="#" class="dropdown-label">Nossas Redes</a>
                <div class="dropdown-content">
                    <a href="https://www.instagram.com/coalizao016/" target="_blank">Instagram</a>
                    <a href="https://www.tiktok.com/@coalizao016?lang=pt-BR" target="_blank">TikTok</a>
                    <a href="https://www.youtube.com/@Coaliz%C3%A3o016" target="_blank">YouTube</a>
                    <a href="https://linktr.ee/coalizao016" target="_blank">Fotos</a>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="ranking-container">
        <h1>Ranking Oficial da Liga</h1>
        
        <div class="explicacao">
            <h2>A Liga Come√ßou!</h2>
            <p>
                A Liga Caipira de Freestyle est√° no ar! A partir de agora, esta p√°gina ser√° atualizada regularmente com a pontua√ß√£o e as estat√≠sticas de todos os MCs, com a precis√£o do <strong>TwolalaScore</strong>. Fique de olho para acompanhar a nova fase do Freestyle do interior!
            </p>
        </div>

        <div class="regulamento-container">
            <details>
                <summary>Clique para ver o Regulamento Completo (v1.2)</summary>
                <div class="regulamento-content">
                    <h3>1) Objetivo</h3>
                    <p>Criar um sistema de ranking cont√≠nuo e justo para os MCs do interior paulista, que gere um calend√°rio competitivo, integre batalhas parceiras, equilibre a disputa entre cidades e garanta total transpar√™ncia. O sistema busca consolidar a Liga Caipira como refer√™ncia regional em freestyle.</p>

                    <h3>2) Abrang√™ncia & Temporada</h3>
                    <ul>
                        <li><strong>Abrang√™ncia:</strong> Batalhas realizadas prioritariamente na regi√£o do DDD 016.</li>
                        <li><strong>Temporada:</strong> Outubro/2025 a Dezembro/2025, culminando na Grande Final da Liga.</li>
                    </ul>

                    <h3>3) Calend√°rio Oficial da Temporada</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Janela</th>
                                <th>Per√≠odo de Batalhas V√°lidas</th>
                                <th>Edi√ß√£o da Coaliz√£o016 Classificat√≥ria</th>
                                <th>Data da Edi√ß√£o</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>-</td>
                                <td>(Edi√ß√£o de Abertura)</td>
                                <td>Edi√ß√£o Quinzenal #1</td>
                                <td>10/10/2025</td>
                            </tr>
                            <tr>
                                <td>Janela 1</td>
                                <td>01/10 a 15/10</td>
                                <td>Edi√ß√£o Quinzenal #2</td>
                                <td>24/10/2025</td>
                            </tr>
                            <tr>
                                <td>Janela 2</td>
                                <td>16/10 a 31/10</td>
                                <td>Edi√ß√£o Quinzenal #3</td>
                                <td>07/11/2025</td>
                            </tr>
                            <tr>
                                <td>Janela 3</td>
                                <td>01/11 a 15/11</td>
                                <td>Edi√ß√£o Quinzenal #4</td>
                                <td>21/11/2025</td>
                            </tr>
                            <tr>
                                <td>Janela 4</td>
                                <td>16/11 a 30/11</td>
                                <td>Edi√ß√£o Quinzenal #5</td>
                                <td>05/12/2025</td>
                            </tr>
                            <tr>
                                <td>Janela 5</td>
                                <td>01/12 a 11/12</td>
                                <td>Encerramento / M.D.A</td>
                                <td>12/12/2025</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>4) Elegibilidade de MCs</h3>
                    <ul>
                        <li><strong>Idade M√≠nima:</strong> 10 anos (menores com autoriza√ß√£o).</li>
                        <li><strong>Cadastro:</strong> Cadastro √∫nico por temporada.</li>
                    </ul>

                    <h3>5) Requisitos M√≠nimos para uma Etapa ser V√°lida</h3>
                    <ul>
                        <li><strong>Chave M√≠nima:</strong> 8 MCs.</li>
                        <li><strong>Formato:</strong> 1x1, 2x2, etc., divulgado previamente.</li>
                        <li><strong>Julgamento:</strong> M√≠nimo de 2 jurados ou voto transparente.</li>
                        <li><strong>Registro:</strong> Foto do campe√£o com folhinha.</li>
                        <li><strong>Envio dos Resultados:</strong> Em at√© 24h.</li>
                        <li><strong>Conduta:</strong> Ambiente livre de incita√ß√£o a viol√™ncia e preconceito.</li>
                    </ul>

                    <h3>6) Sistema de Pontua√ß√£o</h3>
                    <p><strong>a) Pontua√ß√£o Base por Coloca√ß√£o</strong></p>
                    <ul>
                        <li>ü•á Campe√£o: <strong>10 pontos</strong></li>
                        <li>ü•à Vice-Campe√£o: <strong>7 pontos</strong></li>
                        <li>üèÖ Semifinalistas (3¬∫ e 4¬∫): <strong>5 pontos</strong></li>
                        <li>ü•ä Participa√ß√£o (entrou na chave): <strong>2 pontos</strong></li>
                    </ul>
                    <p><strong>b) Pontos B√¥nus</strong></p>
                    <ul>
                        <li>‚úàÔ∏è B√¥nus de Viagem: <strong>+1 ponto</strong> para o MC que competir fora da sua cidade. **(Ainda n√£o implementado, pois a regra exige a cidade do MC, que deve ser buscada na tabela `mcs`).**</li>
                        <li>‚≠ê B√¥nus de Twolala: <strong>+1 ponto</strong> para o MC que vencer qualquer confronto por 2x0.</li>
                    </ul>
                    
                    <h3>7) Limite por Janela (Sistema de Equil√≠brio)</h3>
                    <p>A cada janela de 15 dias, ser√£o considerados apenas os <strong>3 melhores resultados</strong> de cada MC. Isso equilibra as oportunidades e valoriza o alto desempenho. **(Ainda n√£o implementado, pois a regra exige a data de cada confronto).**</p>

                    <h3>8) Acesso √† Edi√ß√£o Quinzenal da Coaliz√£o016</h3>
                    <p>Ao final de cada janela, os <strong>10 MCs mais bem colocados</strong> ganham vaga garantida na edi√ß√£o seguinte da Batalha Coaliz√£o016, mediante confirma√ß√£o.</p>

                    <h3>9) Crit√©rios de Desempate</h3>
                    <ol>
                        <li>Maior quantidade de twolalas aplicados.</li>
                        <li>Maior n¬∫ de t√≠tulos na temporada.</li>
                        <li>Melhor m√©dia de pontos na janela vigente.</li>
                        <li>Maior n¬∫ de janelas em que pontuou.</li>
                        <li>Confronto direto na janela (se houver).</li>
                        <li>Sorteio.</li>
                    </ol>

                    <h3>10) Conduta & Penalidades</h3>
                    <p>Agress√£o f√≠sica, amea√ßas ou condutas discriminat√≥rias (racismo, LGBTfobia, misoginia) resultar√£o em suspens√£o imediata ou banimento da temporada.</p>
                    
                    <h3>11) Transpar√™ncia & Comunica√ß√£o</h3>
                    <p>Ser√£o divulgados dois rankings: o <strong>Ranking da Janela</strong> (desempenho quinzenal) e o <strong>Ranking Geral</strong> (acumulado da temporada). As batalhas parceiras devem informar a realiza√ß√£o de suas etapas at√© a sexta-feira anterior √† semana do evento.</p>
                </div>
            </details>
        </div>

        <div class="ranking-table-container" id="ranking-container-id">
            <h2>Ranking Geral (Temporada)</h2>
            <div id="loader" style="color: #ccc; padding: 30px 0;">Carregando ranking...</div>
            <table id="ranking-table" style="display:none;">
                <thead>
                    <tr>
                        <th class="posicao">#</th>
                        <th>MC</th>
                        <th class="mc-pontos">Pontos</th>
                    </tr>
                </thead>
                <tbody id="ranking-body"></tbody>
            </table>
        </div>
    </div>
    
    <footer>
        ¬© 2025 Coaliz√£o 016 - Todos os direitos reservados.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // 2. Configura a conex√£o com suas chaves (AGORA COM SUA CHAVE INSERIDA)
        const SUPABASE_URL = 'https://rxensjzxoouyczhpftdp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ4ZW5zanp4b3V5Y3pocGZ0ZHBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNTI5MDUsImV4cCI6MjA3NDkyODkwNX0.__J26I9DvvFiJY63EnOgP5DHbKoxQrFYou1TKh1ualk';

        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // L√≥gica principal da p√°gina
        document.addEventListener('DOMContentLoaded', async () => {
            
            // L√≥gica do Menu Hamburger
            const hamburger = document.querySelector(".hamburger");
            const navLinks = document.querySelector(".nav-links");
            if (hamburger && navLinks) {
                hamburger.addEventListener("click", () => navLinks.classList.toggle("active"));
            }

            // L√≥gica do Ranking
            const rankingContainer = document.getElementById('ranking-container-id');
            const loader = document.getElementById('loader');
            const table = document.getElementById('ranking-table');
            const rankingBody = document.getElementById('ranking-body');

            // 3. Busca os dados de duas tabelas ao mesmo tempo
            const { data: mcs, error: mcsError } = await supabase.from('mcs').select('*');
            const { data: logBatalhas, error: logError } = await supabase.from('log_batalhas').select('*');

            if (mcsError || logError) {
                loader.style.display = 'none';
                rankingContainer.innerHTML = '<h2>Erro ao carregar dados. Verifique o console (F12).</h2>';
                console.error(mcsError || logError);
                return;
            }

            if (logBatalhas.length === 0) {
                loader.style.display = 'none';
                // Mensagem de "Em Breve" adaptada para a Supabase
                rankingContainer.innerHTML = '<h2>Ranking Geral (Temporada)</h2><p style="color: #ccc; padding: 30px 0;">O ranking ser√° exibido aqui ap√≥s o cadastro dos primeiros resultados na Supabase. Cadastre-os na tabela `log_batalhas` e recarregue!</p>';
                return;
            }

            // 4. CALCULA AS ESTAT√çSTICAS PARA CADA MC
            // NOTA: Os MCs que n√£o est√£o na tabela 'mcs' n√£o aparecer√£o, o que √© o comportamento desejado.
            mcs.forEach(mc => {
                mc.estatisticas = { pontos: 0 }; 
                logBatalhas.forEach(confronto => {
                    // Verifica se o MC participou do confronto
                    if (confronto.mc1_id === mc.id || confronto.mc2_id === mc.id) {
                        let pontosGanhos = 2; // Participa√ß√£o (2 pontos)
                        
                        // Pontos por coloca√ß√£o
                        if (confronto.fase.toLowerCase().includes('semi')) {
                            pontosGanhos = 5; // Semifinalista (5 pontos)
                        } else if (confronto.fase.toLowerCase().includes('final')) {
                            // Campe√£o (10 pontos) ou Vice (7 pontos)
                            pontosGanhos = (confronto.vencedor_id === mc.id) ? 10 : 7;
                        }
                        mc.estatisticas.pontos += pontosGanhos;
                        
                        // B√¥nus de Twolala (+1 ponto para vit√≥ria 2x0)
                        if (confronto.vencedor_id === mc.id && confronto.placar === '2x0') {
                            mc.estatisticas.pontos += 1; // Twolala (+1 ponto)
                        }
                    }
                });
            });

            // 5. Ordena e exibe a tabela
            // Filtra os MCs que pontuaram para evitar mostrar quem nunca participou
            const mcsOrdenados = mcs
                .filter(mc => mc.estatisticas.pontos > 0)
                .sort((a, b) => b.estatisticas.pontos - a.estatisticas.pontos);
            
            rankingBody.innerHTML = '';
            
            if (mcsOrdenados.length > 0) {
                mcsOrdenados.forEach((mc, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="posicao">${index + 1}</td>
                        <td class="mc-nome">${mc.nome}</td>
                        <td class="mc-pontos">${mc.estatisticas.pontos}</td>
                    `;
                    rankingBody.appendChild(row);
                });
                table.style.display = 'table';
            } else {
                // Caso a log_batalhas tenha dados, mas os MCs n√£o foram encontrados na tabela mcs
                rankingContainer.innerHTML = '<h2>Ranking Geral (Temporada)</h2><p style="color: #ccc; padding: 30px 0;">N√£o foi poss√≠vel vincular os resultados da batalha. Certifique-se de que os MCs na tabela `log_batalhas` est√£o cadastrados na tabela `mcs`.</p>';
            }

            loader.style.display = 'none';
        });
    </script>
</body>
</html>     